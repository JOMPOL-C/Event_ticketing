<%- include('../includes/head') %>
    </head>

    <body class="bg-zinc-50 min-h-screen">
        <%- include('../includes/nav') %>

            <main class="max-w-xl mx-auto p-6">
                <h1 class="text-2xl font-semibold mb-4">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ PromptPay</h1>

                <div class="bg-white rounded-2xl p-6 shadow-sm border border-zinc-200">
                    <p class="text-sm text-zinc-600 mb-2">
                        ‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå: <span class="font-medium">
                            <%= event?.title %>
                        </span>
                    </p>
                    <p class="text-sm text-zinc-600 mb-4">
                        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: <%= order.qty %> ‡πÉ‡∏ö ‚Ä¢ ‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: <%= order.amount.toFixed(2) %>
                                <%= order.currency %>
                    </p>

                    <% if (qrImageUrl) { %>
                        <img src="<%= qrImageUrl %>" alt="PromptPay QR" class="w-full rounded-lg border" />
                        <p class="mt-3 text-xs text-zinc-500">‡∏™‡πÅ‡∏Å‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
                        <% } else { %>
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=TEST_ORDER_<%= order._id %>"
                                alt="QR Code Test" class="w-full rounded-lg border" />
                            <p class="mt-3 text-xs text-zinc-500 text-center text-gray-500">
                                üîπ QR ‡∏à‡∏≥‡∏•‡∏≠‡∏á (‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö)
                            </p>
                            <% } %>

                                <div class="mt-6 flex items-center gap-3">
                                    <button id="btn-check"
                                        class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg">
                                        ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                                    </button>
                                    <span id="status-text" class="text-sm text-zinc-600"></span>
                                </div>
                </div>
            </main>

            <script>
                const orderId = "<%= order._id %>";
                const statusText = document.getElementById('status-text');
                const check = async () => {
                    const res = await fetch(`/api/orders/${orderId}/status`, { credentials: 'include' });
                    const data = await res.json();
                    statusText.textContent = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${data.status}`;
                    if (data.status === 'paid') {
                        window.location.href = '/api/my-tickets';
                    }
                };
                document.getElementById('btn-check').addEventListener('click', check);
                // auto poll ‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥
                setInterval(check, 5000);
                check();
            </script>
    </body>

    </html>