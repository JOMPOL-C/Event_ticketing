<%- include('../includes/head') %>
  <link rel="stylesheet" href="/styles/events.css">
  </head>

  <body class="bg-zinc-50 flex flex-col min-h-screen">
    <%- include('../includes/nav') %>

      <main class="flex-1 max-w-6xl mx-auto px-6 py-10">
        <header class="flex items-center justify-between mb-8">
          <h1 class="text-3xl font-semibold text-zinc-800">‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h1>
        </header>

        <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
        <form method="get" action="/api/events"
          class="grid md:grid-cols-6 sm:grid-cols-2 gap-4 bg-white p-6 rounded-2xl shadow-sm border border-zinc-200 mb-10">
          <div class="md:col-span-2">
            <label class="block text-sm text-zinc-600 mb-1">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</label>
            <input type="text" name="keyword" value="<%= (filters && filters.keyword) || '' %>"
              placeholder="‡∏ä‡∏∑‡πà‡∏≠ / ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà"
              class="w-full border border-zinc-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none" />
          </div>
          <div>
            <label class="block text-sm text-zinc-600 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
            <input type="number" name="priceMin" min="0" value="<%= (filters && filters.priceMin) || '' %>"
              class="w-full border border-zinc-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none" />
          </div>
          <div>
            <label class="block text-sm text-zinc-600 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</label>
            <input type="number" name="priceMax" min="0" value="<%= (filters && filters.priceMax) || '' %>"
              class="w-full border border-zinc-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none" />
          </div>
          <div>
            <label class="block text-sm text-zinc-600 mb-1">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà</label>
            <input type="date" name="dateFrom" value="<%= (filters && filters.dateFrom) || '' %>"
              class="w-full border border-zinc-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none" />
          </div>
          <div>
            <label class="block text-sm text-zinc-600 mb-1">‡∏ñ‡∏∂‡∏á</label>
            <input type="date" name="dateTo" value="<%= (filters && filters.dateTo) || '' %>"
              class="w-full border border-zinc-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none" />
          </div>
          <div>
            <label class="block text-sm text-zinc-600 mb-1">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö</label>
            <select name="sort"
              class="w-full border border-zinc-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 outline-none">
              <option value="date_asc" <%=(filters && filters.sort==='date_asc' ) ? 'selected' : '' %>>‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏Å‡∏•‡πâ ‚Üí
                ‡πÑ‡∏Å‡∏•</option>
              <option value="date_desc" <%=(filters && filters.sort==='date_desc' ) ? 'selected' : '' %>>‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏Å‡∏• ‚Üí
                ‡πÉ‡∏Å‡∏•‡πâ</option>
              <option value="price_asc" <%=(filters && filters.sort==='price_asc' ) ? 'selected' : '' %>>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥ ‚Üí ‡∏™‡∏π‡∏á
              </option>
              <option value="price_desc" <%=(filters && filters.sort==='price_desc' ) ? 'selected' : '' %>>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á ‚Üí ‡∏ï‡πà‡∏≥
              </option>
            </select>
          </div>

          <div class="md:col-span-6 flex gap-3 justify-end mt-2">
            <button type="submit"
              class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium shadow">
              üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            </button>
            <a href="/api/events"
              class="bg-zinc-100 hover:bg-zinc-200 text-zinc-700 px-4 py-2 rounded-lg text-sm font-medium border">
              ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
            </a>
          </div>
        </form>

        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå -->
        <% if (!events || events.length===0) { %>
          <div class="text-center text-zinc-500 border border-dashed border-zinc-300 rounded-2xl py-12 bg-white">
            üïì ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
          </div>
          <% } else { %>
            <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
              <% events.forEach(ev=> {
                const now = new Date();
                const eventEnd = new Date(ev.endAt);
                const isEnded = eventEnd < now; const isSoldOut=(ev.remainingTickets || 0) <=0; const cannotBuy=isEnded
                  || isSoldOut; %>

                  <% if (!cannotBuy) { %>
                    <!-- üü¢ ‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ -->
                    <a href="/api/events/<%= ev._id %>"
                      class="block bg-white rounded-2xl shadow-sm border border-zinc-200 overflow-hidden hover:shadow-md transition relative">
                      <% if (ev.coverImage) { %>
                        <img src="<%= ev.coverImage %>" alt="<%= ev.title %>" class="w-full h-40 object-cover">
                        <% } else { %>
                          <div class="w-full h-40 bg-zinc-100 flex items-center justify-center text-zinc-400 text-sm">
                            ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ
                          </div>
                          <% } %>
                            <div class="p-4">
                              <h2 class="text-lg font-semibold text-zinc-800 truncate">
                                <%= ev.title %>
                              </h2>
                              <p class="text-sm text-zinc-500">
                                <%= new Date(ev.startAt).toLocaleDateString('th-TH', { day:'2-digit', month:'short',
                                  year:'numeric' }) %>
                              </p>
                              <p class="text-sm text-zinc-700 mt-1 font-medium">
                                üí∏ <%= Number(ev.price).toLocaleString('th-TH') %> THB
                              </p>
                            </div>
                    </a>

                    <% } else { %>
                      <!-- üî¥ ‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏´‡∏°‡∏î‡∏ï‡∏±‡πã‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß) -->
                      <div
                        class="relative bg-zinc-200 text-center rounded-2xl border border-zinc-300 overflow-hidden shadow-sm">
                        <% if (ev.coverImage) { %>
                          <img src="<%= ev.coverImage %>" alt="<%= ev.title %>"
                            class="w-full h-40 object-cover opacity-60">
                          <% } else { %>
                            <div class="w-full h-40 bg-zinc-100 flex items-center justify-center text-zinc-400 text-sm">
                              ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ
                            </div>
                            <% } %>
                              <div class="p-4 opacity-70">
                                <h2 class="text-lg font-semibold text-zinc-600 truncate">
                                  <%= ev.title %>
                                </h2>
                                <p class="text-sm text-zinc-500">
                                  <%= new Date(ev.startAt).toLocaleDateString('th-TH', { day:'2-digit', month:'short',
                                    year:'numeric' }) %>
                                </p>
                                <p class="text-sm text-zinc-600 mt-1 font-medium">
                                  üí∏ <%= Number(ev.price).toLocaleString('th-TH') %> THB
                                </p>
                              </div>
                              <div
                                class="absolute inset-0 bg-zinc-800 bg-opacity-60 text-white font-bold text-lg flex items-center justify-center">
                                <%= isEnded ? 'ENDED' : 'SOLD OUT' %>
                              </div>
                      </div>
                      <% } %>

                        <% }) %>

            </div>
            <% } %>
      </main>

      <%- include('../includes/footer') %>
  </body>

  </html>