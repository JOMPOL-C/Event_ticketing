<%- include('../includes/head') %>
  <link rel="stylesheet" href="/styles/detail.css">
  </head>

  <body>
    <%- include('../includes/nav') %>

      <main class="container">
        <h1>
          <%= event.title %>
        </h1>

        <% if (event.coverImage) { %>
          <img src="<%= event.coverImage %>" alt="<%= event.title %> Cover">
          <% } %>

            <p>
              <%= event.description %>
            </p>

            <div class="event-meta">
              <p><strong>สถานที่:</strong> <span>
                  <%= event.venue %>
                </span></p>
              <p><strong>เริ่ม:</strong> <span>
                  <%= new Date(event.startAt).toLocaleString() %>
                </span></p>
              <p><strong>ราคา:</strong> <span>
                  <%= event.price %> THB
                </span></p>
              <p><strong>จบ:</strong> <span>
                  <%= new Date(event.endAt).toLocaleString() %>
                </span></p>
            </div>

            <div id="countdown"></div>

            <% if (user && user.role==='attendee' && event.status==='published' && !event.isSoldOut) { %>
              <form action="/api/checkout" method="POST" class="form-container">
                <input type="hidden" name="eventId" value="<%= event._id %>" />
                <div>
                  <label class="form-label" for="qty-input">จำนวน:</label>
                  <input type="number" id="qty-input" name="qty" value="1" min="1" class="form-input" />
                </div>
                <button type="submit" class="btn-submit">ชำระเงิน</button>
              </form>
              <% } else if (event.isSoldOut) { %>
                <p style="color:red;">Sold out</p>
                <% } %>
      </main>
      <script>
        const countdown = document.getElementById('countdown');
        const startAt = new Date('<%= event.startAt.toISOString() %>');
        function tick() {
          const ms = startAt - new Date();
          if (ms <= 0) { countdown.textContent = 'อีเวนต์เริ่มแล้ว'; return; }
          const d = Math.floor(ms / 86400000),
            h = Math.floor(ms % 86400000 / 3600000),
            m = Math.floor(ms % 3600000 / 60000),
            s = Math.floor(ms % 60000 / 1000);
          countdown.textContent = `เหลืออีก ${d} วัน ${h} ชม. ${m} นาที ${s} วินาที`;
        }
        tick(); setInterval(tick, 1000);
      </script>
  </body>

  </html>