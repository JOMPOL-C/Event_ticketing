<%- include('../includes/head') %>
</head><body>
<%- include('../includes/nav') %>
<main class="container" style="max-width:960px;margin:24px auto;padding:0 16px;">
  <h1><%= event.title %></h1>
  <% if (event.coverImage) { %><img src="<%= event.coverImage %>" style="max-width:100%;height:auto;"><% } %>
  <p><%= event.description %></p>
  <p>สถานที่: <%= event.venue %></p>
  <p>เริ่ม: <%= new Date(event.startAt).toLocaleString() %></p>
  <p>ราคา: <%= event.price %> THB</p>
  <div id="countdown" style="font-weight:bold;margin:8px 0;"></div>

  <% if (user && user.role === 'attendee' && event.status === 'published' && !event.isSoldOut) { %>
    <form action="/api/orders/checkout" method="post">
      <input type="hidden" name="eventId" value="<%= event._id %>">
      <input type="number" name="qty" min="1" value="1">
      <button type="submit">ซื้อบัตร</button>
    </form>
  <% } else if (event.isSoldOut) { %>
    <p style="color:red;">Sold out</p>
  <% } %>
</main>
<script>
  const countdown = document.getElementById('countdown');
  const startAt = new Date('<%= event.startAt.toISOString() %>');
  function tick() {
    const ms = startAt - new Date();
    if (ms <= 0) { countdown.textContent = 'อีเวนต์เริ่มแล้ว'; return; }
    const d = Math.floor(ms/86400000),
          h = Math.floor(ms%86400000/3600000),
          m = Math.floor(ms%3600000/60000),
          s = Math.floor(ms%60000/1000);
    countdown.textContent = `เหลืออีก ${d} วัน ${h} ชม. ${m} นาที ${s} วินาที`;
  }
  tick(); setInterval(tick, 1000);
</script>
</body></html>
